<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ</text></svg>">
    <title>Gemini Watermark Remover - Local & Free</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f0e8 0%, #e8dfd1 50%, #d4c8b8 100%);
            min-height: 100vh;
            color: #3d3225;
            padding: 20px;
            overflow-x: hidden;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(139, 90, 43, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(160, 120, 70, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(101, 67, 33, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: bgPulse 8s ease-in-out infinite;
        }

        @keyframes bgPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        /* Animated Donation Button */
        .donate-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(90deg, #8b5a2b, #a0784a, #c4a574, #8b5a2b);
            background-size: 300% 100%;
            color: #fff;
            padding: 12px 25px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1em;
            animation: gradientMove 3s ease infinite, bounce 2s ease-in-out infinite;
            box-shadow: 0 5px 25px rgba(139, 90, 43, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.2s;
        }

        .donate-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 35px rgba(139, 90, 43, 0.6);
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .donate-btn:hover {
            animation: gradientMove 3s ease infinite;
            transform: scale(1.1) translateY(0);
        }

        .donate-btn svg {
            animation: heartbeat 1.5s ease-in-out infinite;
            flex-shrink: 0;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .donate-btn > span {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .donate-subtext {
            font-size: 0.7em;
            opacity: 0.9;
            font-weight: normal;
            margin-top: 2px;
        }

        .lang-switcher {
            display: flex;
            gap: 5px;
            background: rgba(139, 90, 43, 0.1);
            padding: 5px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 90, 43, 0.2);
        }

        .lang-btn {
            background: transparent;
            border: none;
            padding: 8px 18px;
            border-radius: 20px;
            color: #6b5344;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: linear-gradient(90deg, #8b5a2b, #a0784a);
            color: #fff;
            font-weight: bold;
        }

        .lang-btn:hover:not(.active) {
            color: #3d3225;
            background: rgba(139, 90, 43, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 3em;
            background: linear-gradient(90deg, #654321, #8b5a2b, #a0784a, #654321);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textShine 3s linear infinite;
        }

        @keyframes textShine {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .subtitle {
            text-align: center;
            color: #6b5344;
            margin-bottom: 30px;
            font-size: 1.1em;
            letter-spacing: 2px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid rgba(139, 90, 43, 0.2);
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(139, 90, 43, 0.1);
        }

        .stat:hover {
            transform: translateY(-5px);
            border-color: rgba(139, 90, 43, 0.4);
            box-shadow: 0 10px 30px rgba(139, 90, 43, 0.2);
        }


        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #654321;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6b5344;
            margin-top: 5px;
        }

        .drop-zone {
            border: 3px dashed rgba(139, 90, 43, 0.4);
            border-radius: 30px;
            padding: 60px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .drop-zone::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(139, 90, 43, 0.1), transparent 30%);
            animation: rotate 4s linear infinite;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .drop-zone:hover::before, .drop-zone.dragover::before {
            opacity: 1;
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        .drop-zone:hover, .drop-zone.dragover {
            border-color: #8b5a2b;
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0 10px 40px rgba(139, 90, 43, 0.2);
        }

        .drop-zone h2 {
            margin-bottom: 10px;
            font-size: 1.8em;
            position: relative;
            z-index: 1;
            color: #3d3225;
        }

        .drop-zone p {
            color: #6b5344;
            position: relative;
            z-index: 1;
        }


        .upload-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .upload-btn {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(139, 90, 43, 0.3);
            padding: 15px 30px;
            border-radius: 50px;
            color: #3d3225;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 1em;
            user-select: none;
            -webkit-user-select: none;
        }

        .upload-btn:active {
            transform: scale(0.95);
        }

        .upload-btn:hover {
            border-color: #8b5a2b;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 25px rgba(139, 90, 43, 0.2);
            transform: translateY(-3px);
        }

        .upload-btn svg {
            width: 22px;
            height: 22px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(90deg, #8b5a2b, #a0784a);
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 25px rgba(139, 90, 43, 0.3);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(139, 90, 43, 0.4);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        button.secondary {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            box-shadow: none;
            border: 2px solid rgba(139, 90, 43, 0.3);
            color: #3d3225;
        }

        button.secondary:hover:not(:disabled) {
            background: rgba(255,255,255,0.9);
            border-color: rgba(139, 90, 43, 0.5);
            box-shadow: 0 5px 20px rgba(139, 90, 43, 0.15);
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .image-card {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(139, 90, 43, 0.2);
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(139, 90, 43, 0.1);
        }

        .image-card:hover {
            transform: translateY(-5px);
            border-color: rgba(139, 90, 43, 0.4);
            box-shadow: 0 15px 40px rgba(139, 90, 43, 0.2);
        }

        .image-card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }

        .image-card .info {
            padding: 18px;
        }

        .image-card .name {
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 1.05em;
            color: #3d3225;
        }

        .image-card .status {
            font-size: 0.9em;
            margin-top: 8px;
        }

        .image-card .status.pending { color: #8b7355; }
        .image-card .status.processing { color: #a0784a; }
        .image-card .status.done { color: #5a7a3a; }
        .image-card .status.error { color: #a04040; }

        .image-card .badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(90deg, #5a7a3a, #7a9a4a);
            color: #fff;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(90, 122, 58, 0.3);
        }

        [dir="ltr"] .image-card .badge {
            right: auto;
            left: 15px;
        }

        .progress-bar {
            height: 6px;
            background: rgba(139, 90, 43, 0.15);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 25px;
        }

        .progress-bar .fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5a2b, #a0784a);
            width: 0%;
            transition: width 0.3s;
            box-shadow: 0 0 15px rgba(139, 90, 43, 0.4);
        }

        .hidden { display: none; }

        #fileInput, #folderInput {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Footer */
        .footer {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(139, 90, 43, 0.2);
            text-align: center;
        }

        .credits {
            color: #6b5344;
            font-size: 0.95em;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6b5344;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 25px;
            background: rgba(255,255,255,0.7);
            border: 1px solid rgba(139, 90, 43, 0.2);
            transition: all 0.3s;
        }

        .social-link:hover {
            color: #3d3225;
            border-color: #8b5a2b;
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(139, 90, 43, 0.15);
        }

        .social-link svg {
            width: 20px;
            height: 20px;
        }

        .made-with {
            margin-top: 20px;
            color: #8b7355;
            font-size: 0.85em;
        }

        .credit-small {
            margin-top: 8px;
            color: #a89880;
            font-size: 0.7em;
        }

        /* Donate Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: linear-gradient(135deg, #f5f0e8, #e8dfd1);
            border-radius: 25px;
            padding: 35px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid rgba(139, 90, 43, 0.2);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #6b5344;
            padding: 5px 10px;
            box-shadow: none;
        }

        [dir="ltr"] .modal-close {
            left: auto;
            right: 15px;
        }

        .modal-close:hover {
            color: #3d3225;
            transform: none;
            box-shadow: none;
        }

        .modal h2 {
            color: #3d3225;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .modal p {
            color: #6b5344;
            margin-bottom: 20px;
            font-size: 0.95em;
        }

        .qr-container {
            background: #fff;
            padding: 15px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(139, 90, 43, 0.15);
        }

        .qr-container img {
            width: 180px;
            height: 180px;
        }

        .phone-number {
            background: rgba(139, 90, 43, 0.1);
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            direction: ltr;
        }

        .phone-number span {
            font-size: 1.4em;
            font-weight: bold;
            color: #654321;
            letter-spacing: 1px;
        }

        .modal-instructions {
            font-size: 0.85em;
            color: #8b7355;
            line-height: 1.6;
        }

        .modal-btn {
            display: inline-block;
            margin-top: 15px;
            background: linear-gradient(90deg, #8b5a2b, #a0784a);
            color: #fff;
            padding: 12px 30px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 90, 43, 0.4);
        }

        /* Instructions Section */
        .instructions {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(139, 90, 43, 0.2);
            text-align: center;
        }

        .instructions h3 {
            color: #654321;
            margin-bottom: 25px;
            font-size: 1.5em;
        }

        .instructions-steps {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(139, 90, 43, 0.08);
            padding: 15px 20px;
            border-radius: 15px;
            transition: all 0.3s;
        }

        .step:hover {
            background: rgba(139, 90, 43, 0.15);
            transform: translateY(-2px);
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(90deg, #8b5a2b, #a0784a);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step p {
            color: #3d3225;
            margin: 0;
            text-align: start;
        }

        .instructions-tip {
            color: #5a7a3a;
            font-weight: bold;
            margin: 0;
            padding: 15px;
            background: rgba(90, 122, 58, 0.1);
            border-radius: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div></div>
            <div class="lang-switcher">
                <button class="lang-btn active" data-lang="he">×¢×‘×¨×™×ª</button>
                <button class="lang-btn" data-lang="en">English</button>
            </div>
        </div>

        <h1 data-i18n="title">××¡×™×¨ ×¡×™×× ×™ ××™× ×©×œ Gemini</h1>
        <p class="subtitle" data-i18n="subtitle">100% ××§×•××™ | ×—×™× ××™ | ×œ×œ× ×”×¢×œ××” | ××™×™×“×™</p>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-label" data-i18n="totalImages">×¡×”"×› ×ª××•× ×•×ª</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="processedCount">0</div>
                <div class="stat-label" data-i18n="processed">×¢×•×‘×“×•</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="avgTime">0ms</div>
                <div class="stat-label" data-i18n="avgTime">×–××Ÿ ×××•×¦×¢</div>
            </div>
        </div>

        <!-- Donate Button Above Drop Zone -->
        <div style="text-align: center; margin-bottom: 20px;">
            <button class="donate-btn" onclick="openDonateModal()" type="button">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                <span>
                    <span data-i18n="donateWithBit">×ª×¨×•× ×¢× Bit</span>
                    <span class="donate-subtext" data-i18n="donateHint">5 ×©"×— = ××œ×¤×™ ×˜×•×§× ×™× ×‘×§×œ×•×“ ğŸ˜‹</span>
                </span>
            </button>
        </div>

        <div class="drop-zone" id="dropZone">
            <h2 data-i18n="dropHere">×’×¨×•×¨ ×ª××•× ×•×ª ×œ×›××Ÿ</h2>
            <p data-i18n="orClick">××• ×œ×—×¥ ×œ×‘×—×™×¨×ª ×§×‘×¦×™×</p>
            <p style="margin-top: 10px; font-size: 0.9em;" data-i18n="supports">×ª×•××š ×‘: JPG, PNG, WebP</p>
        </div>

        <div class="upload-options">
            <label class="upload-btn" for="fileInput">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span data-i18n="selectFiles">×‘×—×¨ ×§×‘×¦×™×</span>
            </label>
            <label class="upload-btn" for="folderInput">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                </svg>
                <span data-i18n="selectFolder">×‘×—×¨ ×ª×™×§×™×™×”</span>
            </label>
        </div>

        <input type="file" id="fileInput" multiple accept="image/*">
        <input type="file" id="folderInput" webkitdirectory multiple accept="image/*">

        <div class="controls">
            <button id="clearBtn" class="secondary" data-i18n="clearAll">× ×§×” ×”×›×œ</button>
        </div>

        <div class="progress-bar" id="progressBar">
            <div class="fill" id="progressFill"></div>
        </div>

        <div class="gallery" id="gallery"></div>

        <!-- Instructions Section -->
        <div class="instructions">
            <h3 data-i18n="howToUseTitle">××™×š ×œ×”×©×ª××©?</h3>
            <div class="instructions-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <p data-i18n="howToUseStep1">×”×¢×œ×• ×ª××•× ×” ×‘×•×“×“×ª ××• ×ª×™×§×™×™×” ×©×œ××”</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <p data-i18n="howToUseStep2">×”×ª××•× ×•×ª ×™×¢×•×‘×“×• ××•×˜×•××˜×™×ª ×‘×¨×’×¢ ×”×”×¢×œ××”</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <p data-i18n="howToUseStep3">×ª××•× ×” ×‘×•×“×“×ª ×ª×¨×“ ×™×©×™×¨×•×ª, ×ª×™×§×™×™×” ×ª×¨×“ ×›×§×•×‘×¥ ZIP</p>
                </div>
            </div>
            <p class="instructions-tip" data-i18n="howToUseTip">×”×›×œ ×§×•×¨×” ××§×•××™×ª ×‘××—×©×‘ ×©×œ×›× - ××™×Ÿ ×”×¢×œ××” ×œ×©×¨×ª!</p>
        </div>

        <div class="footer">
            <div class="social-links">
                <a href="https://www.tiktok.com/@elimalka_ai" target="_blank" class="social-link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z"/>
                    </svg>
                    <span>TikTok</span>
                </a>
                <a href="https://www.instagram.com/elimalka_ai" target="_blank" class="social-link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/>
                    </svg>
                    <span>Instagram</span>
                </a>
                <a href="https://www.youtube.com/@ELI_MALKA_AI" target="_blank" class="social-link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                    <span>YouTube</span>
                </a>
            </div>
            <div class="made-with">@ELI_MALKA_AI</div>
            <div class="credit-small" data-i18n="creditOriginal">××‘×•×¡×¡ ×¢×œ gemini-watermark-remover ×××ª journey-ad</div>
        </div>
    </div>

    <!-- Donate Modal -->
    <div class="modal-overlay" id="donateModal" onclick="closeDonateModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeDonateModal()">&times;</button>
            <h2 data-i18n="modalTitle">×ª×¨×•××” ×¢× Bit</h2>
            <p data-i18n="modalDesc">×¡×¨×§×• ××ª ×”×§×•×“ ××• ×”×•×¡×™×¤×• ××ª ×”××¡×¤×¨ ×œ×× ×©×™ ×”×§×©×¨</p>

            <div class="qr-container">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=https://www.bitpay.co.il/app/me/972527182810" alt="Bit QR Code">
            </div>

            <div class="phone-number">
                <span>+972-52-718-2810</span>
            </div>

            <p class="modal-instructions" data-i18n="modalInstructions">
                ×¤×ª×—×• ××ª ××¤×œ×™×§×¦×™×™×ª Bit ×‘× ×™×™×“, ×œ×—×¦×• ×¢×œ "×©×œ×— ×›×¡×£",<br>
                ×”×•×¡×™×¤×• ××ª ×”××¡×¤×¨ ×œ×× ×©×™ ×§×©×¨ ××• ×¡×¨×§×• ××ª ×”×§×•×“
            </p>

            <a href="https://www.bitpay.co.il/app/me/972527182810" target="_blank" class="modal-btn" data-i18n="openInBit">
                ×¤×ª×— ×‘-Bit (× ×™×™×“)
            </a>
        </div>
    </div>

    <!-- JSZip for folder downloads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        // ============== I18N ==============
        const translations = {
            he: {
                title: '××¡×™×¨ ×¡×™×× ×™ ××™× ×©×œ Gemini',
                subtitle: '100% ××§×•××™ | ×—×™× ××™ | ×œ×œ× ×”×¢×œ××” | ××™×™×“×™',
                totalImages: '×¡×”"×› ×ª××•× ×•×ª',
                processed: '×¢×•×‘×“×•',
                avgTime: '×–××Ÿ ×××•×¦×¢',
                dropHere: '×’×¨×•×¨ ×ª××•× ×•×ª ×œ×›××Ÿ',
                orClick: '××• ×œ×—×¥ ×œ×‘×—×™×¨×ª ×§×‘×¦×™×',
                supports: '×ª×•××š ×‘: JPG, PNG, WebP',
                donateHint: '5 ×©"×— = ××œ×¤×™ ×˜×•×§× ×™× ×‘×§×œ×•×“ ğŸ˜‹',
                selectFiles: '×‘×—×¨ ×§×‘×¦×™×',
                selectFolder: '×‘×—×¨ ×ª×™×§×™×™×”',
                clearAll: '× ×§×” ×”×›×œ',
                donateWithBit: '×ª×¨×•× ×¢× Bit',
                creditOriginal: '××‘×•×¡×¡ ×¢×œ gemini-watermark-remover ×××ª journey-ad',
                modalTitle: '×ª×¨×•××” ×¢× Bit',
                modalDesc: '×¡×¨×§×• ××ª ×”×§×•×“ ××• ×”×•×¡×™×¤×• ××ª ×”××¡×¤×¨ ×œ×× ×©×™ ×”×§×©×¨',
                modalInstructions: '×¤×ª×—×• ××ª ××¤×œ×™×§×¦×™×™×ª Bit ×‘× ×™×™×“, ×œ×—×¦×• ×¢×œ "×©×œ×— ×›×¡×£", ×”×•×¡×™×¤×• ××ª ×”××¡×¤×¨ ×œ×× ×©×™ ×§×©×¨ ××• ×¡×¨×§×• ××ª ×”×§×•×“',
                openInBit: '×¤×ª×— ×‘-Bit (× ×™×™×“)',
                waiting: '×××ª×™×Ÿ...',
                processing: '××¢×‘×“...',
                doneIn: '×”×•×©×œ× ×‘-',
                clean: '× ×§×™',
                howToUseTitle: '××™×š ×œ×”×©×ª××©?',
                howToUseStep1: '×”×¢×œ×• ×ª××•× ×” ×‘×•×“×“×ª ××• ×ª×™×§×™×™×” ×©×œ××”',
                howToUseStep2: '×”×ª××•× ×•×ª ×™×¢×•×‘×“×• ××•×˜×•××˜×™×ª ×‘×¨×’×¢ ×”×”×¢×œ××”',
                howToUseStep3: '×ª××•× ×” ×‘×•×“×“×ª ×ª×¨×“ ×™×©×™×¨×•×ª, ×ª×™×§×™×™×” ×ª×¨×“ ×›×§×•×‘×¥ ZIP',
                howToUseTip: '×”×›×œ ×§×•×¨×” ××§×•××™×ª ×‘××—×©×‘ ×©×œ×›× - ××™×Ÿ ×”×¢×œ××” ×œ×©×¨×ª!'
            },
            en: {
                title: 'Gemini Watermark Remover',
                subtitle: '100% Local | Free | No Upload | Instant',
                totalImages: 'Total Images',
                processed: 'Processed',
                avgTime: 'Avg Time',
                dropHere: 'Drop Images Here',
                orClick: 'or click to select files',
                supports: 'Supports: JPG, PNG, WebP',
                donateHint: '5â‚ª = thousands of Claude tokens ğŸ˜‹',
                selectFiles: 'Select Files',
                selectFolder: 'Select Folder',
                clearAll: 'Clear All',
                donateWithBit: 'Donate with Bit',
                creditOriginal: 'Based on gemini-watermark-remover by journey-ad',
                modalTitle: 'Donate with Bit',
                modalDesc: 'Scan the QR code or add the number to contacts',
                modalInstructions: 'Open the Bit app on your phone, tap "Send Money", add the number to contacts or scan the code',
                openInBit: 'Open in Bit (mobile)',
                waiting: 'Waiting...',
                processing: 'Processing...',
                doneIn: 'Done in ',
                clean: 'CLEAN',
                howToUseTitle: 'How to Use?',
                howToUseStep1: 'Upload a single image or an entire folder',
                howToUseStep2: 'Images are processed automatically upon upload',
                howToUseStep3: 'Single image downloads directly, folder downloads as ZIP',
                howToUseTip: 'Everything happens locally on your computer - no server upload!'
            }
        };

        let currentLang = 'he';

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'he' ? 'rtl' : 'ltr';

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            // Only update UI if state is initialized
            if (typeof state !== 'undefined') {
                updateUI();
            }
            localStorage.setItem('lang', lang);
        }

        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
        });

        // ============== REVERSE ALPHA BLENDING CORE ==============
        const ALPHA_THRESHOLD = 0.002;
        const MAX_ALPHA = 0.99;
        const LOGO_VALUE = 255;

        const alphaMasks = {};

        function detectWatermarkConfig(width, height) {
            if (width > 1024 && height > 1024) {
                return { size: 96, margin: 64 };
            }
            return { size: 48, margin: 32 };
        }

        function calculatePosition(imgWidth, imgHeight, config) {
            return {
                x: imgWidth - config.size - config.margin,
                y: imgHeight - config.size - config.margin,
                width: config.size,
                height: config.size
            };
        }

        function removeWatermark(imageData, alphaMap, position) {
            const { data, width } = imageData;
            const { x: startX, y: startY, width: wmWidth, height: wmHeight } = position;

            for (let y = 0; y < wmHeight; y++) {
                for (let x = 0; x < wmWidth; x++) {
                    const imageX = startX + x;
                    const imageY = startY + y;
                    const imageIdx = (imageY * width + imageX) * 4;
                    const alphaIdx = y * wmWidth + x;

                    let alpha = alphaMap[alphaIdx];

                    if (alpha < ALPHA_THRESHOLD) continue;
                    alpha = Math.min(alpha, MAX_ALPHA);

                    const divisor = 1 - alpha;

                    data[imageIdx] = Math.max(0, Math.min(255, Math.round((data[imageIdx] - alpha * LOGO_VALUE) / divisor)));
                    data[imageIdx + 1] = Math.max(0, Math.min(255, Math.round((data[imageIdx + 1] - alpha * LOGO_VALUE) / divisor)));
                    data[imageIdx + 2] = Math.max(0, Math.min(255, Math.round((data[imageIdx + 2] - alpha * LOGO_VALUE) / divisor)));
                }
            }
        }

        async function loadAlphaMask(size) {
            if (alphaMasks[size]) return alphaMasks[size];

            const img = new Image();
            await new Promise((resolve, reject) => {
                img.onload = resolve;
                img.onerror = () => reject(new Error(`Failed to load bg_${size}.png - make sure the file exists`));
                img.src = `bg_${size}.png`;
            });

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = size;
            canvas.height = size;
            ctx.drawImage(img, 0, 0);

            const imageData = ctx.getImageData(0, 0, size, size);
            const data = imageData.data;
            const mask = new Float32Array(size * size);

            for (let i = 0; i < mask.length; i++) {
                const idx = i * 4;
                const r = data[idx];
                const g = data[idx + 1];
                const b = data[idx + 2];
                const maxChannel = Math.max(r, g, b);
                mask[i] = maxChannel / 255.0;
            }

            alphaMasks[size] = mask;
            console.log(`Loaded Gemini alpha mask ${size}x${size}`);
            return mask;
        }

        async function processImage(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = async () => {
                    const startTime = performance.now();

                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.naturalWidth;
                    canvas.height = img.naturalHeight;
                    ctx.drawImage(img, 0, 0);

                    const config = detectWatermarkConfig(canvas.width, canvas.height);
                    const position = calculatePosition(canvas.width, canvas.height, config);
                    const alphaMask = await loadAlphaMask(config.size);

                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    removeWatermark(imageData, alphaMask, position);
                    ctx.putImageData(imageData, 0, 0);

                    const processingTime = performance.now() - startTime;

                    canvas.toBlob((blob) => {
                        resolve({
                            blob,
                            time: processingTime,
                            width: canvas.width,
                            height: canvas.height
                        });
                    }, file.type || 'image/png', 0.95);
                };
                img.onerror = () => reject(new Error('Failed to load image'));
                img.src = URL.createObjectURL(file);
            });
        }

        // ============== UI CODE ==============
        const state = {
            files: [],
            processed: [],
            processing: false,
            isFolder: false,
            currentBatchSize: 0
        };

        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const folderInput = document.getElementById('folderInput');
        const gallery = document.getElementById('gallery');
        const clearBtn = document.getElementById('clearBtn');
        const progressFill = document.getElementById('progressFill');

        dropZone.addEventListener('click', (e) => {
            fileInput.click();
        });
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            // If multiple files dropped, treat as folder
            handleFiles(files, files.length > 1);
        });

        // Labels with for="" automatically trigger inputs, just handle the change event
        fileInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files.length > 0) {
                const files = Array.from(e.target.files);
                handleFiles(files, false);
            }
            e.target.value = '';
        });
        folderInput.addEventListener('change', (e) => {
            if (e.target.files && e.target.files.length > 0) {
                const files = Array.from(e.target.files);
                handleFiles(files, true);
            }
            e.target.value = '';
        });

        clearBtn.addEventListener('click', clearAll);

        function handleFiles(fileList, isFolder = false) {
            const filesArray = Array.isArray(fileList) ? fileList : Array.from(fileList);
            const newFiles = filesArray.filter(f => f.type.startsWith('image/'));
            console.log(`[Upload] ${newFiles.length} images added (folder: ${isFolder})`);

            // Track batch info
            state.isFolder = isFolder || newFiles.length > 1;
            state.currentBatchSize = newFiles.length;

            newFiles.forEach(file => {
                const id = Date.now() + Math.random().toString(36).substr(2, 9);
                state.files.push({
                    id,
                    file,
                    status: 'pending',
                    preview: URL.createObjectURL(file)
                });
            });
            console.log(`[Total] ${state.files.length} images in queue`);
            updateUI();
            // Auto-process and download immediately
            if (newFiles.length > 0) {
                processAll();
            }
        }

        async function processAll() {
            if (state.processing) return;
            state.processing = true;

            const pending = state.files.filter(f => f.status === 'pending');
            const isMultiple = state.isFolder || pending.length > 1;
            const batchItems = [];
            let times = [];
            let successCount = 0;
            let errorCount = 0;

            console.log(`[Process] Starting to process ${pending.length} images... (ZIP: ${isMultiple})`);

            for (let i = 0; i < pending.length; i++) {
                const item = pending[i];
                item.status = 'processing';
                updateUI();

                try {
                    console.log(`[Process] ${i + 1}/${pending.length}: ${item.file.name}`);
                    const result = await processImage(item.file);
                    item.status = 'done';
                    item.result = result;
                    item.processedPreview = URL.createObjectURL(result.blob);
                    times.push(result.time);
                    state.processed.push(item);
                    batchItems.push(item);
                    successCount++;
                    console.log(`[Success] ${item.file.name} - ${result.time.toFixed(0)}ms`);
                } catch (err) {
                    item.status = 'error';
                    item.error = err.message;
                    errorCount++;
                    console.error(`[Error] ${item.file.name}: ${err.message}`);
                }

                progressFill.style.width = ((i + 1) / pending.length * 100) + '%';
                updateUI();
            }

            state.processing = false;

            if (times.length > 0) {
                const avg = times.reduce((a, b) => a + b, 0) / times.length;
                document.getElementById('avgTime').textContent = avg.toFixed(0) + 'ms';
            }

            // Auto-download: ZIP for multiple files, direct for single
            if (batchItems.length > 0) {
                if (isMultiple && batchItems.length > 1) {
                    await downloadAsZip(batchItems);
                } else if (batchItems.length === 1) {
                    downloadSingleFile(batchItems[0]);
                }
            }

            console.log(`[Done] Processed: ${successCount} success, ${errorCount} errors`);
            console.log(`[Stats] Total processed ever: ${state.processed.length}`);

        }

        async function downloadAsZip(items) {
            const zip = new JSZip();

            items.forEach(item => {
                const name = item.file.name.replace(/\.[^.]+$/, '') + '-clean' + getExtension(item.file.name);
                zip.file(name, item.result.blob);
            });

            const content = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(content);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'watermark-removed-' + Date.now() + '.zip';
            a.click();
            URL.revokeObjectURL(url);
        }

        function downloadSingleFile(item) {
            const name = item.file.name.replace(/\.[^.]+$/, '') + '-clean' + getExtension(item.file.name);
            const url = URL.createObjectURL(item.result.blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
            URL.revokeObjectURL(url);
        }

        function getExtension(filename) {
            const match = filename.match(/\.[^.]+$/);
            return match ? match[0] : '.png';
        }

        function clearAll() {
            state.files.forEach(f => {
                if (f.preview) URL.revokeObjectURL(f.preview);
                if (f.processedPreview) URL.revokeObjectURL(f.processedPreview);
            });
            state.files = [];
            state.processed = [];
            progressFill.style.width = '0%';
            updateUI();
        }

        function updateUI() {
            const t = translations[currentLang];

            document.getElementById('totalCount').textContent = state.files.length;
            document.getElementById('processedCount').textContent = state.processed.length;

            gallery.innerHTML = state.files.map(item => `
                <div class="image-card">
                    <img src="${item.processedPreview || item.preview}" alt="${item.file.name}">
                    ${item.status === 'done' ? `<div class="badge">${t.clean}</div>` : ''}
                    <div class="info">
                        <div class="name">${item.file.name}</div>
                        <div class="status ${item.status}">
                            ${item.status === 'pending' ? t.waiting : ''}
                            ${item.status === 'processing' ? t.processing : ''}
                            ${item.status === 'done' ? `${t.doneIn}${item.result.time.toFixed(0)}ms` : ''}
                            ${item.status === 'error' ? item.error : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Donate Modal Functions
        function openDonateModal() {
            document.getElementById('donateModal').classList.add('active');
        }

        function closeDonateModal(event) {
            if (!event || event.target === event.currentTarget) {
                document.getElementById('donateModal').classList.remove('active');
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeDonateModal();
        });

        // Load saved language (after state is initialized)
        const savedLang = localStorage.getItem('lang');
        if (savedLang) {
            setLanguage(savedLang);
        }

        // Load masks on startup
        Promise.all([loadAlphaMask(48), loadAlphaMask(96)])
            .then(() => console.log('Alpha masks loaded successfully'))
            .catch(err => {
                console.error('Failed to load alpha masks:', err);
                alert('Error: Could not load watermark masks (bg_48.png, bg_96.png). Make sure these files exist.');
            });
    </script>
</body>
</html>
